#include <vector>
#include <iostream>
#include "spline.h"
using namespace std;


#define fur(a) for (int i=0; i<(a); i++)

void print(vector<double> ar){
    for(auto q: ar)
        cout<<q<<", ";

    cout<<endl<<endl<<endl<<endl<<endl;
}


void fPeaks(vector<double> sig, vector<double>* loc1, vector<double>* loc2){
    for(int i=1; i<sig.size()-1; i++){
        if(sig[i]>sig[i-1] && sig[i]>sig[i+1]){
            loc1->push_back(i);
            loc2->push_back(sig[i]);
        }
    }
}

void fTroughs(vector<double> sig, vector<double>* loc1, vector<double>* loc2){
    for(int i=1; i<sig.size()-1; i++){
        if(sig[i]<sig[i-1] && sig[i]<sig[i+1]){
            loc1->push_back(i);
            loc2->push_back(sig[i]);
        }
    }
}

void meanV(vector<double> ar1, vector<double> ar2, vector<double>* loc){
    fur(ar1.size()){
        loc->push_back((ar1[i]+ar2[i])/2);
    }
}

double minV(vector<double> ar){
    double ans=ar[0];
    for(auto q: ar){
        if(q<ans) 
            ans=q;
    }
    return(ans);
}

double maxV(vector<double> ar){
    double ans=ar[0];
    for(auto q: ar){
        if(q>ans) 
            ans=q;
    }
    return(ans);
}

double sumSqrd(vector<double> ar, int st, int ed){
    double ans=0;
    for(int i=st; i<ed; i++){
        ans+=ar[i]*ar[i];
    }
    return(ans);
}

double sum(vector<double> ar, int st, int ed){
    double sm=0;
    for(int i=st; i<ed; i++){
        sm+=ar[i];
    }
    return(sm);
}

void emdFilter(vector<double> sig,  vector<double>* loc){
    float stoplim = 0.01;
    // creates range(len(sig))
    int t[sig.size()];
    fur(sig.size())
        t[i]=i;


    // creates "r_t" based on input signal
    vector<double> r_t; // index of peaks
    for(auto q: sig)
        r_t.push_back(q);

    // initializes is_imf
    bool is_imf = false;

    vector<double> pks_loc; // index of peaks
    vector<double> pks_vls; // value of peaks

    vector<double> trs_loc; // index of troughs
    vector<double> trs_vls; // value of troughs

    vector<double> mean_t; // middle of imf

    vector<double> pks_t;
    vector<double> trs_t;

    while(!is_imf){
        // cleans array and finds peaks
        pks_loc.clear();
        pks_vls.clear();
        fPeaks(r_t, &pks_loc, &pks_vls);

        // cleans array and finds troughs
        trs_loc.clear();
        trs_vls.clear();
        fTroughs(r_t, &trs_loc, &trs_vls);
        
        pks_t.clear();
        tk::spline fip(pks_loc, pks_vls);
        for(auto q: t)
            pks_t.push_back(fip(q));

        trs_t.clear();
        tk::spline fitr(trs_loc, trs_vls);
        for(auto q: t)
            trs_t.push_back(fitr(q));

        
        // Calculate mean
        mean_t.clear();
        meanV(pks_t, trs_t, &mean_t);

        double samp_start = max(minV(pks_loc), minV(trs_loc));

        double samp_end = min(maxV(pks_loc), maxV(trs_loc))+1;

        double sdk = sumSqrd(mean_t, samp_start, samp_end) / sumSqrd    (r_t, samp_start, samp_end);

        
        for(int i=0; i<samp_start; i++){
            mean_t[i] = mean_t[samp_start];
        }

        for(int i=samp_end; i<mean_t.size(); i++){
            mean_t[i] = mean_t[samp_end];
        }
        
        // if not imf, update r_t and is_imf
        if(sdk < stoplim)
            is_imf=true;

        else
            transform(r_t.begin(), r_t.end(), mean_t.begin(), r_t.begin(), std::minus<int>());
                
    }

    transform(sig.begin(), sig.end(), r_t.begin(), sig.begin(), std::minus<int>());

    for(auto q: sig)
        loc->push_back(q);
}

void removeDc(vector<double> data, int sr, vector<double>* loc){
    int med = sr/2;
    sr=med*2;
    double sm = sum(data, 0, sr)/sr;

    vector<double> dc;

    fur(med)
        dc.push_back(sm);
    
    for(int i=med; i<data.size()-med; i++){
        dc.push_back((dc[dc.size()-1]+(-data[i-med]/sr+data[i+med]/sr)));
    }

    sm = dc[dc.size()-1];
    fur(med)
        dc.push_back(sm);

    fur(data.size()){
        data[i] -= dc[i];
    }

    for(auto q: data){
        loc->push_back(q);
    }
}

void process(vector<double> inputSignal, vector<double>* outputLoc, int samplingRate){
    vector<double> noDc;
    removeDc(inputSignal, samplingRate, &noDc);

    emdFilter(noDc, outputLoc);
}

int main(){
    //double qq[] = {-37.82821807859489, -37.82821807859489, -37.82821807859489, -37.82821807859489, -37.82821807859489, -46.101271758823685, -46.79165349301479, -41.51281195127504, -31.878195803711208, -19.501253720430213, -5.99543437153892, 7.025813572855725, 18.063741253351424, 26.078399053363796, 30.636852923000845, 33.275431836324174, 35.97547160040892, 40.5290723304322, 48.29992813775752, 59.12734481039081, 72.32360806108125, 86.61731162490781, 100.78793452596929, 114.4021889221126, 127.35459615526628, 140.06368116993667, 153.0009587583656, 166.32589950115897, 180.03094481785382, 193.7524636953458, 207.05252397102092, 219.55206131686919, 230.86409399497813, 240.51110279322359, 247.99293413092857, 252.8094344274159, 254.4604501020085, 252.82067369633606, 249.26418224125564, 245.51875625469708, 243.22760571365507, 243.53426154886415, 245.66810904695387, 248.4084733180376, 250.6485844102674, 251.52083727906953, 251.00038157092888, 249.27653797315236, 246.55255664527533, 243.092826834858, 239.39236466933068, 235.96143728935309, 233.14068900863145, 231.03704288149876, 228.99215975174855, 226.36940036943537, 223.38418732019886, 220.52361986437924, 218.5094421255335, 217.85996548498895, 218.0451254919368, 218.2727637375342, 218.01035790958235, 217.7639300824584, 218.24057514908722, 219.91313489000714, 222.83413515222594, 225.6090911610147, 226.77832451198196, 226.06839290382186, 223.77687600668747, 221.2992052734831, 220.02062680298494, 220.18779349470543, 221.52661082102424, 222.8185877450528, 222.85741827607822, 221.4299331173562, 218.73336820921543, 215.61344374630528, 213.02576259270205, 211.71697403586944, 212.2173513062399, 214.4006169827344, 217.82121866947932, 221.41305472293413, 223.95488618764136, 224.56512462278593, 223.72078364612094, 222.27267437756865, 221.20819588715887, 221.20932553762873, 221.5997659124364, 221.498694007922, 220.56545925123066, 218.78190185013764, 216.87965270413326, 215.66954959074315, 215.52946710791832, 216.56881706182074, 218.25612327103056, 219.8772951291055, 220.62867231709617, 219.87201740257947, 217.72035421174473, 214.734832392835, 212.517843623697, 212.62759179655984, 215.404287631579, 220.50388473629584, 226.0633014398685, 229.83969725185943, 230.1040172821835, 227.1823490421662, 222.14217227823974, 216.9613932758524, 213.4421856252897, 211.77336559716917, 211.60846079175982, 212.07320144760297, 212.21379919201692, 211.28618856915716, 208.8482970547208, 205.45630093373586, 202.02774260664293, 199.9273801262027, 200.2370697393572, 202.4598448174538, 205.54054288141162, 207.7700409260325, 207.75679898785052, 206.0335697964489, 203.68232169573383, 202.05759279385552, 202.1773232847927, 203.44049194159322, 204.84133718207227, 205.46954332072605, 204.79657825877337, 202.59644641154932, 199.47151466412987, 196.29010553543094, 194.1560016099878, 194.02914333644327, 196.05864255425013, 199.84638308665566, 203.6161653012756, 205.56369899267762, 205.15041511886972, 202.51620586794658, 199.24908718491014, 196.94487319284642, 195.78244697027117, 195.41644969155814, 194.82148595908404, 193.2334019859368, 191.61304700004564, 191.23937036582083, 192.9387189787535, 197.01872339899762, 202.16475131427546, 206.83242291353156, 210.1806312630299, 211.5440876483646, 210.47231701196768, 207.3740989236229, 203.1336110750186, 199.67736901810883, 199.01068394047164, 202.41171171191587, 210.16927293645657, 219.34200247270292, 226.41979925033394, 228.84780422871393, 225.23392217915546, 217.88187109107986, 209.8078378081928, 203.18207137322872, 199.39225709692187, 197.541763162978, 196.37550576689517, 195.48891027837163, 194.7289556831573, 194.0983262570087, 193.54306517588466, 192.62694592654572, 191.08509083266836, 189.72028725478992, 189.6022388126633, 191.5816136767203, 195.63293822010849, 201.2752176163179, 207.08151403749048, 211.63953503905324, 214.54151271091933, 215.76238496429906, 215.8033884611051, 215.29761284503402, 214.87926093621525, 215.0826175264872, 216.04118211809043, 217.6001385808119, 218.85219354422065, 218.8346136797533, 217.11538306653426, 213.73683283171977, 210.1079648869037, 207.74864650450135, 207.25553561577408, 208.73218485490895, 211.23293500894954, 213.78920855987178, 216.38996661652413, 219.26355494447353, 222.48638143839622, 225.52710250940697, 227.47639111176855, 226.52073785589647, 221.25540099270268, 212.81489167893062, 203.8004786047596, 200.1412076882807, 207.77413509783798, 229.3405807748734, 265.0274444691959, 308.49968139098314, 352.21133986594816, 390.29478522157854, 418.54746226845907, 437.7488167477891, 449.66359918837196, 455.0157783388149, 453.6604138230661, 443.01771054663243, 420.550692185321, 386.32851221457895, 341.0718565597637, 286.678823518896, 229.75716088064934, 177.56434923246786, 135.24715086622496, 106.20067439164356, 88.92413198541442, 80.60117093359776, 78.04907539276059, 78.23320209170865, 79.07756117769361, 79.15940453314202, 78.7102975627335, 78.5037984915227, 79.8271233038119, 83.61446093383516, 88.8742343563066, 94.13857269220162, 97.96019560705975, 99.41965798151837, 99.68826501204092, 100.3242232396716, 102.34259426794983, 106.24861357706314, 111.05135709129706, 115.53644841508748, 119.09186142937472, 121.25615758422566, 121.75944240101484, 121.09799768634787, 119.99060615971257, 119.27987790689247, 119.65711881659061, 121.08459062289069, 123.26769354535256, 125.61342590005995, 127.5912817216051, 129.21913982208991, 130.55818215887774, 131.29441849286798, 131.02769179698902, 129.3883500887497, 126.25739031913662, 122.48790012846837, 119.13820109043888, 117.11545982291153, 116.93569406457604, 117.70148099325877, 118.25620560276218, 117.81992471165756, 116.01188665617497, 113.67143401841179, 111.94293294193221, 111.7521383284651, 113.15036011239715, 115.92500350830568, 119.68229981887009, 124.05375170659636, 128.95312118519485, 134.32940884743135, 139.9903102510914, 145.87716015371282, 152.60715514682408, 160.85367360196926, 170.83895917676455, 182.47645142855245, 194.8955082275089, 207.1091779946914, 218.4493530418501, 228.36206538207705, 236.43106194313998, 242.30630191926485, 245.764878655835, 246.9083329828537, 247.00886151764587, 247.53255724051152, 249.55044279632983, 254.03477324612464, 261.23859570872276, 268.53812553416276, 272.90491357983564, 272.56868450133015, 266.91733934587825, 258.71331092908696, 251.21790551843088, 246.31339142047966, 244.93275349175465, 245.5908807494892, 246.29883934644067, 245.47049981675104, 242.0510529371029, 236.7081660729561, 230.6357058458063, 225.4098593125159, 222.34315975983333, 221.31120495868595, 221.62274352033336, 221.75606293318475, 220.3974017735632, 217.89526409229933, 215.1188619166202, 213.35797370483124, 213.59882777135942, 215.19288542403922, 217.08291621905687, 218.4140920789947, 219.14119439201875, 219.55157900581438, 220.4532901405612, 222.50184088342834, 225.22193141705043, 227.90233933398295, 230.01896477100058, 231.19283083132885, 231.4383299397786, 230.93821990825262, 230.1553507754354, 229.61852329125531, 229.84024882383426, 231.0788435330058, 232.59213212725717, 233.3933885036491, 232.5181747648836, 229.4712184597235, 225.6116207155353, 222.65731711030443, 221.9072074458868, 223.99997141812912, 227.35244407496828, 229.82599930236427, 229.65598022509346, 226.5736069231998, 221.102423697204, 215.43939477426693, 211.79204663845636, 210.7367348748266, 212.16228067620483, 214.8385385655232, 217.35281659169985, 218.68120357749314, 218.1172035979759, 215.83520096363975, 212.3731244947439, 208.84220081520078, 206.26302993189123, 204.7204075799175, 203.90727917932423, 202.88499316170362, 200.91573917445885, 198.6966687166895, 197.20949478452667, 197.13921451052988, 198.7527839722644, 200.94171089088832, 202.2536408984579, 201.65933761802245, 199.82203663660357, 197.83316437215942, 196.80443860242332, 197.38942334167302, 198.38877619058957, 198.39441259589407, 197.0161858020639, 194.37063540406194, 191.58310860103762, 189.8479352442638, 189.62656818932078, 191.06619129207894, 193.78978940525963, 197.2166589270508, 200.47554144065305, 202.6934431776226, 203.280983777924, 202.08083529753355, 200.38026604806748, 199.6637464259815, 200.75995891144896, 203.93738517126135, 207.87949153496555, 210.8734904977968, 211.57210768446112, 210.09012123754593, 207.02678075768853, 203.45716915984474, 200.32105151118196, 197.54108817339647, 194.9049239360909, 192.67724600596375, 191.28361291370405, 191.31602606886878, 193.20286724794843, 196.55159681630124, 200.66749683400266, 204.46805755112928, 206.9501070721162, 207.8156167288322, 207.08674350028627, 205.36124372661538, 203.41273571358812, 202.14268626837134, 202.3420922343348, 204.2322220982607, 207.72344389482288, 212.05225220685003, 216.28667325420952, 219.61319914114915, 221.69218550943913, 222.33238059327795, 221.4622394590557, 219.15985255973416, 215.9821450623706, 212.66015436786512, 210.14253209839347, 209.19153601851906, 209.60623424108024, 210.8970956852634, 212.38338214737234, 213.31865961619164, 212.88491797331062, 210.3856816410836, 205.68218931211948, 199.16107551671692, 192.7528438656799, 188.68614650040476, 188.83836060415229, 194.23975706694293, 202.8834565639719, 211.9780242757456, 218.6309536188432, 220.7759776439495, 219.75285970210075, 217.75287071942114, 216.73936292367443, 217.76401374918322, 220.97623507316237, 223.82805133783654, 223.59262807841034, 219.52508263699804, 211.94351419985256, 203.43599752287247, 196.82466521188994, 193.59790570282564, 194.4063643774287, 197.88345857067497, 202.17121107403108, 205.46329455170064, 206.3564657904339, 205.00816819442895, 202.16652174198705, 199.3816660903728, 198.09239746083688, 198.49011865161037, 200.2585673602099, 202.2982143043135, 203.50811196253733, 203.5649068370903, 202.33964393607937, 199.85748445896132, 196.76005437059246, 194.26593154313727, 195.2850367125933, 202.89293812962552, 219.13645123973532, 244.75058714784402, 276.25189240171756, 309.2886921710582, 340.25489067046675, 366.36259486548727, 387.35114368053667, 403.22719943614203, 412.53948607839806, 413.3464396402072, 403.203282876136, 380.3444163343738, 346.22416501594114, 303.58685498436273, 257.1168921003522, 211.63129996693408, 170.53749335918974, 136.89048484521447, 113.08984596847444, 98.91338417391842, 93.00599058144047, 92.10265510923176, 92.80488605189521, 93.09016641138294, 91.81650804115833, 89.98806349337923, 89.04131842088546, 89.9959501805505, 93.402852253927, 98.35459091725227, 103.51055901456397, 107.25578286641638, 108.30889544313499, 106.99732283761296, 104.28719552086011, 102.09066835378547, 102.27240972353442, 105.56111773229702, 111.94469015199675, 119.58379371844273, 126.29596937605419, 130.35348593980382, 130.72050348498306, 128.67401925760407, 126.06923979635951, 124.58765596755302, 125.21589594793295, 128.27744620553463, 132.13808906309725, 134.8874949525551, 135.46859088791706, 133.48446761636342, 130.3256142356837, 127.66679675778073, 126.53249050039892, 127.32768332901199, 128.6297039941678, 128.7510367663221, 126.77244711048735, 122.42726781758878, 117.2908197876452, 113.24093117693127, 111.52347105765216, 112.74537040063348, 115.58976685525215, 118.42680100441999, 120.29841848663568, 120.77773083857306, 120.89070813401935, 122.02653508104015, 125.19967262658588, 129.9256866731464, 135.29613390843215, 140.20542920549497, 143.937997712744, 147.53544749467721, 152.40880514092885, 159.68958842559073, 170.09334781351617, 182.9512733481468, 197.08361427785465, 210.6512170921444, 221.92042353319357, 230.2389591127377, 235.55805024765476, 239.16154320583382, 242.45033305371186, 245.9608902009046, 249.74580973152868, 252.78661008452264, 254.12458780463925, 254.11122850506592, 253.4774201280681, 253.1614708637877, 254.153543964336, 256.8837272852887, 259.5418070960802, 260.0929230317123, 257.8439297755975, 252.93551348785934, 247.50197118705466, 243.6700502779419, 241.54268885165413, 240.54740025307365, 239.43380815570384, 237.16006335652315, 234.19631481778907, 231.37826049984926, 229.49179619013336, 229.07950879596885, 229.76055187719288, 230.9557452475327, 232.21600708376627, 233.05112020960505, 232.676227673443, 230.34611230493866, 225.76875583412476, 219.11301821526564, 211.93807339917748, 206.15067383581425, 203.31353936632712, 203.61325939665608, 206.60585325859142, 210.70119042253498, 214.29374776395892, 216.8625816400055, 218.25013863268785, 218.66784674183486, 218.42347361131297, 217.8411640433244, 217.26190471065976, 217.07767261012845, 217.55435779079176, 218.40251218669937, 219.20914877467564, 219.62246281765397, 219.46687647552278, 219.21053720988078, 219.33746894064043, 219.75147611925854, 220.24182380712023, 220.7198389737806, 221.2397787474682, 222.30555898293562, 224.2871100657381, 226.56876177811637, 228.2884437514827, 228.7603674487553, 228.00387165887565, 226.37502046330414, 224.87165178755242, 224.36702456811489, 224.59430794136597, 224.96362703122105, 224.73302071188004, 223.29054323048524, 220.6963965756645, 217.30453391181558, 213.97176536493134, 211.58845875994797, 210.67635575598, 211.39339357152068, 212.8109178283986, 213.76418422972696, 213.2306804004196, 210.67186055210635, 207.34281332147873, 204.83644767599776, 204.30331948113792, 206.31141819530285, 209.54082075059648, 212.19962594754804, 212.87259213603866, 211.6511158633573, 209.1842256065765, 206.84483936449556, 205.79251899730087, 205.6095122890008, 205.58242873746957, 205.39263877222288, 204.9669096469817, 204.8188349806449, 205.44793444355093, 206.71060554661864, 208.2999674147783, 209.89914778842592, 211.23670848833308, 212.23293904130895, 212.79562694391151, 212.59082386565808, 211.40595035312305, 209.75563828815177, 208.272186813889, 207.33135278340603, 206.98736406303874, 206.26487486225312, 203.93114597629744, 199.18256802748763, 192.93205094640786, 186.6366515826975, 182.2134951539481, 181.18428451436031, 183.02896469662153, 186.61110284117362, 190.3705123409905, 192.91896753171224, 193.97984026711288, 193.81643705261442, 193.74020548209631, 195.16465785879709, 198.86342423493306, 204.98352394837482, 211.80541573063033, 217.21536978310564, 219.38946279316093, 217.2749984038925, 212.61438159538852, 207.75633781460076, 204.6797730389443, 204.6483295087824, 206.4344139858078, 208.18762436204543, 208.4167712316704, 207.06751599745894, 204.6641026442298, 202.6082546763718, 202.09711895120685, 202.63205621821874, 203.3304456189796, 203.46952597125096, 202.55014909335574, 200.80775912967226, 198.5484898798579, 195.62664143863026, 191.7911909253763, 186.82165726309836, 180.93575111159504, 176.073408274234, 174.95164970514534, 181.67361181794087, 200.1418181737685, 232.07022546444028, 277.3562102540489, 330.81939546514496, 385.7786018680201, 434.62719526547073, 470.61899184884635, 491.37506433120353, 495.6082995560258, 482.67091922894804, 454.4724845042096, 413.6807635841078, 363.439013414565, 307.29483647999245, 249.93772867513212, 196.18740231865777, 150.24254201464146, 115.37315925470477, 91.75560079526969, 78.32543964126883, 72.14881852687677, 70.00799525119592, 69.41911814379648, 68.5469328662744, 67.41668387785876, 66.73110974051903, 68.0424266295517, 72.67830498226428, 80.21875467068111, 89.58912756946927, 98.84380412915039, 105.81942194420958, 108.94403227482132, 109.01134104391821, 107.49450035879642, 106.2187924014508, 106.69178971525795, 108.79809621442462, 112.00698764349386, 115.74939569752314, 119.49093227009698, 122.87427409839262, 125.54689281723734, 126.99837480846577, 126.8145749543636, 125.1243073920146, 122.34122233756631, 119.47535506862334, 117.5468929124583, 117.02024633355859, 118.06753033250695, 120.24745491705028, 122.78625964581258, 124.19370727376014, 122.98292211226422, 118.3969515019761, 110.39062508801783, 101.0359787041159, 92.9343497311479, 88.32628710695661, 88.00918599724628, 91.92913143924761, 98.0701217284361, 104.21692539448802, 109.31947864563892, 112.82326785081548, 114.99081234315224, 116.25484243860484, 116.91189942020753, 117.27445340749986, 117.85487889896456, 119.26223610110208, 122.2924236735405, 127.68838726919455, 135.794422060999, 146.67693190699615, 159.68940588563964, 173.8951225157306, 187.90943285704805, 200.45936735602842, 211.16660146476045, 220.05944106026448, 227.89806871363612, 235.62563616948978, 243.81044275998673, 251.52137816747768, 257.57924631049644, 261.31191770212035, 262.52999218871815, 262.4679203552811, 262.3759024396426, 262.143286552385, 261.3026626764424, 259.3204404114065, 255.93620643094187, 252.04843608834818, 248.67329460552054, 246.13881799910143, 244.4995218365983, 243.40396909423055, 242.54697140148377, 242.21428759219611, 242.64101872267332, 243.2686875347381, 243.38413685915646, 242.44906819694995, 240.2845229820192, 237.97404370952495, 236.91679813994284, 238.12780077409604, 241.08545307419638, 244.70711697725488, 247.20260935809029, 247.04656363445008, 244.4804244579903, 240.2985852297669, 235.7404231145283, 231.923933273966, 229.03659909385203, 226.89182335368716, 224.7371981838064, 221.87535951969585, 218.39492916661152, 214.77255885549462, 212.2510341502565, 212.0232848972611, 214.3166842397123, 218.78269122434494, 223.73466521517832, 227.41302523995986, 229.10452866406592, 228.6832218376096, 227.32596871202293, 226.53533763906773, 227.46866504858542, 229.90235968273566, 233.20562033970597, 236.4997337294741, 239.04609521860058, 240.91444688818672, 242.2649819018964, 242.8113510391056, 242.28443827652922, 240.93060276452707, 239.19929580271796, 237.83686211411305, 237.30396417529184, 236.62164205371437, 234.55574113724103, 230.2909505044513, 223.65108002231264, 216.59757902062438, 211.2534583983267, 208.25033586809042, 207.4830207178455, 207.39048172282907, 206.53969284349873, 205.4654892938878, 205.1946716014237, 206.70361245968525, 210.7669732268572, 217.62642605354299, 225.59339759541467, 232.5985449357034, 236.97969236280886, 237.61243412694475, 235.11627712041252, 230.63327518544534, 225.65175732191568, 221.5275249386864, 218.73999392294377, 217.39710432252372, 216.99727834953705, 216.9506223683182, 216.92349718782083, 216.7372762744685, 216.57712927994498, 216.5287980880496, 215.91651732578157, 214.02139781662467, 210.71356242679985, 206.25175993566745, 201.8602307324079, 199.004588108657, 198.66923837819547, 199.9137599433841, 201.04408467054233, 199.27638619324313, 192.1406100949852, 179.51154799171798, 163.1063927287755, 149.66709603658114, 147.17756860664718, 163.56479808975212, 204.41843816436372, 266.0357296604404, 341.2300529784341, 418.1717596492816, 485.1841983637777, 535.8457353216656, 566.0611569796248, 575.78591331313, 565.9590576382004, 537.4033931142369, 491.5253478100684, 432.182099588857, 363.84351376234815, 291.68617824763, 222.90224591050207, 162.14529033146766, 113.25755961837012, 78.9940870246318, 57.76104638599037, 46.69881773674055, 42.23346532308892, 40.94335714513821, 40.730392006665056, 40.26194627548807, 39.94377577192199, 40.610883980153005, 43.07688558735731, 47.79074091131491, 53.764181589230816, 59.68516943425763, 64.3838156439138, 67.06177757926025, 68.26474787116257, 68.79587578282425, 69.1441018369955, 69.66968002165203, 70.53232692612653, 71.91561523379983, 74.2990794028891, 78.03409393963028, 82.66343176749723, 87.52771541427336, 92.0529426021265, 96.0066118307621, 99.28559669216776, 101.96277036992399, 104.10420667481154, 105.57278233482089, 106.33126656228887, 106.94519558972752, 107.90754225909535, 108.818258829961, 108.98574330868345, 107.44519727117267, 103.60812428881388, 98.664432345342, 94.14422895298446, 91.16001532558903, 90.24139808565634, 90.00401178867833, 88.96302837938623, 87.14574142647882, 85.20373258751059, 84.77361425149161, 87.25591452742589, 92.1217936728371, 98.360069982379, 105.11258380719806, 112.13326372441185, 119.46716298452253, 127.71174530559989, 137.3037965104233, 147.48498037304535, 157.4553348787888, 167.44351690678536, 178.01845741506162, 190.08156478341533, 204.17546625033086, 219.0751870672674, 233.18553007933895, 245.19801049330198, 254.19676886989663, 260.5497348241538, 264.89857851759155, 267.6961432433856, 269.46845827009156, 271.2231236361263, 273.99080289718387, 278.41284290820573, 284.61915759631836, 291.0832458781422, 295.8645029176706, 297.3625864240128, 295.3382042867386, 290.17768111148575, 283.4087581877027, 276.5064497743601, 269.59344532470715, 262.5241006210975, 255.43176156802315, 248.73627663311777, 243.72451441444167, 241.4994164041332, 241.56119554021348, 242.78119369317778, 243.11799701753483, 240.82014001237857, 236.20870627113175, 230.30729234417961, 224.87699751542755, 221.52049229636108, 220.46922937526773, 221.44722992610414, 223.52000688870226, 225.6925653654115, 227.38638734277606, 228.1270740283885, 227.6570450140618, 226.5859934284905, 225.57248434113296, 224.60329704762216, 223.4120011076761, 221.3911129111791, 218.12945623144174, 214.34213754530958, 210.9502817757651, 208.57280492680172, 207.56550323310893, 207.5339027711484, 207.94146553927243, 208.43366738162263, 208.73403083613138, 208.69625137010553, 208.24016856715366, 207.42002554671626, 206.46581092237403, 206.17609174843767, 207.31113317848477, 209.90941432243199, 213.6857559476722, 217.78213149516608, 221.19730257426585, 223.05811088296892, 223.00371847385242, 220.6507945955716, 215.0137169265156, 205.59210038793083, 194.42880044275887, 184.51682458607615, 180.10654789980163, 184.3945148378302, 195.10457975511906, 208.38959456013052, 219.59109147428472, 224.9318715107554, 224.97113053677185, 221.45195342340867, 216.5165862030662, 212.11481161915498, 209.02739809780036, 207.70187299624152, 208.4218137134569, 211.05878826263123, 214.00027707203327, 215.37606208906146, 213.76921892254876, 208.543730768565, 201.73391751069454, 196.04168320440033, 193.77936676420265, 195.70104654085162, 201.56622540473953, 208.7143648685955, 214.27995505383845, 216.99764187430844, 216.4055845833691, 213.65584000005822, 210.2424358553041, 207.413385961921, 206.1480612617907, 206.59727513117787, 208.49789527495147, 210.75956427801395, 212.2261703694747, 212.30580947523669, 210.88095179489636, 209.16735692602947, 208.418382260317, 208.70448696788185, 209.6334892404571, 210.14554157777548, 209.45673789183326, 208.55460343568313, 208.86952129764137, 211.50786415084337, 216.27996300769985, 222.25504840400015, 226.8339906297706, 227.52809932036192, 223.95880173818392, 216.68125423603692, 207.87541190122454, 199.86816303245752, 193.9493300395702, 190.8109971518582, 189.791361765337, 189.94656104981368, 190.5583781035407, 191.15488215653582, 192.02364103743287, 193.62884276829328, 196.38165754627255, 200.4542867220041, 205.11607408493705, 209.4718909989778, 212.87157668704538, 214.9888818712232, 216.54823541123926, 218.53673570123283, 221.57994619102044, 224.85729055312743, 227.20032779138614, 227.4952980121488, 225.19280100475717, 221.9461941879939, 219.67214086030944, 219.13777020938733, 220.3966245348574, 221.79743269490245, 221.5427962673816, 218.95562115030754, 214.03520085581866, 208.3660750324019, 203.85398657016978, 202.10424518938805, 203.85519704187368, 206.67776717549566, 207.1057574519449, 200.69189809214583, 184.69584693788232, 164.18604395514, 147.3252420741829, 146.84466395818612, 176.61764970355227, 246.82861188217942, 350.6576910002321, 468.601852168511, 578.9094985301018, 662.678942303954, 712.4081320124719, 725.3578999881873, 706.4409775006894, 662.2559444810852, 598.4928765694979, 520.5793225932691, 433.80122841959763, 343.6083593907673, 256.24736170954236, 177.74087213874208, 112.4186088209255, 63.36730545585118, 30.394676592338385, 11.842001351767976, 3.463836296706006, 0.7071733072176869, 0.37546809218082444, 0.2635746328846835, 0.7754761714528513, 2.967438265217595, 7.575899810998294, 14.057993063562662, 21.506174902091402, 28.833507345469002, 35.29429930215741, 41.68724209922567, 48.860670462966084, 56.31711029795838, 63.17753772350858, 68.38253853954052, 71.27189324605007, 72.96255146270323, 74.81786230381404, 77.40960374261806, 80.82719405283932, 84.02218385123416, 85.90457556124079, 86.35604648999282, 85.53070554259824, 83.70071313236576, 81.18399238962684, 78.36346580460241, 75.78690145157455, 74.59645038118128, 76.08285938814942, 81.05066277879769, 88.35954490581241, 96.14375054986792, 101.58061615722295, 102.24479423939079, 98.25710990331987, 90.73572870751008, 82.24200542123407, 75.30282644342849, 70.86401548091396, 69.13408462009744, 68.95336215784641, 68.99121248690096, 68.60132817302991, 67.51118281210572, 66.25904594738574, 65.58588610897331, 66.23267182697191, 68.94037163148505, 74.44995405261608, 83.50238762046854, 83.50238762046854, 83.50238762046854, 83.50238762046854, 83.50238762046854};
    double qq[] = {1086, 826, 411, 592, 1097, 969, 455, 522, 1072, 1070, 534, 482, 1038, 1180, 592, 475, 1011, 1210, 701, 493, 976, 1258, 874, 558, 899, 1294, 1057, 628, 852, 1330, 1204, 698, 778, 1330, 1330, 765, 727, 1304, 1403, 838, 678, 1245, 1424, 940, 681, 1118, 1425, 1017, 682, 1026, 1407, 1127, 681, 905, 1371, 1232, 710, 792, 1324, 1306, 747, 711, 1284, 1356, 865, 663, 1219, 1403, 828, 654, 1102, 1400, 986, 649, 1028, 1392, 1100, 677, 904, 1348, 1217, 702, 791, 1321, 1299, 747, 716, 1276, 1360, 798, 670, 1192, 1391, 861, 656, 1156, 1388, 892, 653, 1022, 1382, 1083, 672, 942, 1363, 1191, 690, 816, 1329, 1288, 724, 718, 1276, 1370, 766, 658, 1225, 1389, 882, 639, 1144, 1387, 962, 647, 1011, 1357, 1067, 659, 897, 1353, 1171, 693, 802, 1317, 1272, 720, 702, 1266, 1346, 769, 662, 1304, 1374, 854, 629, 1086, 1397, 960, 650, 1030, 1375, 1054, 650, 910, 1359, 1161, 673, 805, 1315, 1249, 709, 712, 1278, 1341, 771, 677, 1226, 1366, 849, 637, 1133, 1387, 942, 685, 1028, 1369, 1025, 653, 915, 1348, 1156, 669, 798, 1309, 1227, 692, 725, 1260, 1316, 767, 654, 1189, 1376, 800, 647, 1141, 1396, 959, 648, 1062, 1389, 1057, 663, 942, 1377, 1159, 680, 839, 1329, 1260, 713, 734, 1290, 1341, 775, 700, 1255, 1377, 828, 668, 1136, 1377, 930, 648, 1104, 1488, 1204, 857, 1177, 1569, 1396, 943, 1092, 1556, 1434, 875, 862, 1344, 1347, 715, 593, 1122, 1269, 699, 506, 1005, 1263, 800, 522, 935, 1242, 905, 544, 848, 1256, 1034, 572, 738, 1229, 1140, 608, 641, 1195, 1250, 674, 598, 1161, 1273, 756, 568, 1113, 1306, 826, 564, 1013, 1306, 940, 581, 861, 1279, 1031, 588, 755, 1247, 1159, 621, 671, 1218, 1228, 643, 596, 1158, 1277, 676, 570, 1038, 1326, 837, 586, 1028, 1345, 1006, 648, 965, 1375, 1135, 707, 892, 1382, 1265, 745, 804, 1354, 1369, 804, 751, 1309, 1441, 857, 698, 1210, 1427, 924, 686, 1144, 1425, 1042, 686, 1015, 1387, 1121, 688, 886, 1362, 1232, 717, 780, 1323, 1315, 752, 710, 1282, 1372, 805, 664, 1192, 1412, 858, 663, 1106, 1412, 1008, 677, 1009, 1388, 1118, 692, 890, 1370, 1235, 708, 786, 1329, 1314, 744, 706, 1269, 1379, 822, 649, 1191, 1387, 951, 647, 1104, 1394, 996, 660, 1017, 1378, 1092, 662, 896, 1362, 1199, 692, 786, 1322, 1286, 736, 710, 1277, 1356, 783, 652, 1195, 1393, 858, 641, 1117, 1381, 974, 638, 1018, 1378, 1093, 658, 895, 1370, 1199, 689, 783, 1329, 1247, 728, 716, 1264, 1363, 780, 663, 1204, 1390, 877, 632, 1129, 1389, 982, 637, 1015, 1391, 1089, 669, 920, 1360, 1190, 693, 804, 1328, 1298, 735, 719, 1287, 1353, 774, 691, 1193, 1385, 862, 643, 1133, 1395, 952, 647, 1019, 1380, 1072, 665, 914, 1338, 1163, 668, 794, 1320, 1260, 725, 736, 1272, 1360, 788, 662, 1222, 1409, 859, 658, 1192, 1380, 993, 637, 1025, 1366, 1046, 667, 920, 1355, 1165, 680, 816, 1324, 1254, 703, 734, 1270, 1335, 754, 664, 1196, 1376, 847, 640, 1177, 1466, 1061, 794, 1200, 1540, 1245, 883, 1147, 1548, 1357, 837, 934, 1380, 1269, 686, 627, 1195, 1237, 686, 560, 1177, 1268, 738, 526, 998, 1280, 868, 531, 936, 1291, 935, 563, 847, 1253, 1062, 592, 747, 1241, 1164, 642, 657, 1225, 1257, 694, 597, 1175, 1297, 736, 589, 1098, 1309, 860, 566, 981, 1307, 952, 585, 872, 1274, 1046, 586, 743, 1250, 1151, 624, 664, 1217, 1247, 683, 606, 1170, 1310, 773, 590, 1191, 1342, 880, 624, 1061, 1385, 1019, 690, 1006, 1394, 1181, 719, 917, 1391, 1288, 757, 806, 1361, 1365, 817, 752, 1301, 1420, 873, 690, 1196, 1423, 924, 685, 1096, 1411, 1044, 677, 1004, 1396, 1152, 704, 881, 1366, 1246, 726, 785, 1312, 1343, 775, 671, 1264, 1395, 778, 661, 1196, 1417, 917, 662, 1094, 1409, 1019, 664, 998, 1397, 1144, 681, 807, 1358, 1240, 718, 792, 1336, 1318, 765, 710, 1272, 1387, 842, 662, 1204, 1412, 894, 653, 1104, 1406, 1000, 654, 1001, 1377, 1115, 674, 901, 1357, 1212, 701, 775, 1313, 1293, 735, 709, 1263, 1359, 801, 652, 1195, 1386, 903, 642, 1066, 1380, 998, 649, 1005, 1379, 1104, 667, 897, 1358, 1206, 700, 790, 1319, 1294, 736, 704, 1256, 1337, 791, 637, 1179, 1363, 868, 631, 1113, 1381, 980, 640, 1003, 1371, 1091, 674, 908, 1375, 1207, 707, 798, 1319, 1300, 746, 710, 1286, 1360, 794, 652, 1213, 1389, 860, 644, 1118, 1384, 968, 642, 1010, 1359, 1058, 643, 906, 1331, 1185, 716, 844, 1453, 1449, 946, 1009, 1572, 1640, 1096, 915, 1431, 1539, 933, 699, 1102, 1323, 882, 540, 906, 1247, 927, 525, 787, 1230, 1051, 542, 678, 1212, 1169, 608, 606, 1173, 1249, 677, 567, 1120, 1284, 780, 556, 1053, 1308, 874, 563, 955, 1310, 971, 566, 851, 1277, 1084, 601, 732, 1248, 1174, 627, 635, 1191, 1229, 686, 547, 1130, 1280, 747, 546, 1081, 1299, 838, 559, 962, 1291, 965, 582, 860, 1291, 1107, 649, 795, 1324, 1256, 729, 755, 1317, 1370, 828, 740, 1303, 1445, 912, 708, 1242, 1455, 990, 713, 1109, 1430, 1095, 702, 997, 1414, 1198, 713, 873, 1380, 1274, 744, 782, 1312, 1365, 789, 709, 1256, 1417, 853, 681, 1192, 1416, 933, 660, 1086, 1399, 1045, 664, 963, 1365, 1146, 676, 864, 1352, 1258, 715, 770, 1304, 1334, 754, 687, 1236, 1380, 810, 658, 1166, 1403, 922, 658, 1076, 1393, 1044, 657, 947, 1386, 1136, 663, 861, 1319, 1228, 700, 758, 1294, 1319, 751, 674, 1244, 1371, 834, 686, 1181, 1399, 940, 659, 1081, 1395, 1018, 651, 997, 1389, 1130, 671, 869, 1355, 1235, 709, 778, 1311, 1314, 752, 688, 1247, 1356, 805, 625, 1151, 1361, 856, 570, 1073, 1459, 1151, 882, 1273, 1699, 1488, 1059, 1226, 1663, 1498, 932, 910, 1382, 1305, 691, 612, 1139, 1215, 667, 500, 1012, 1225, 741, 483, 946, 1225, 856, 500, 841, 1240, 986, 533, 750, 1209, 1092, 572, 643, 1191, 1179, 626, 577, 1162, 1251, 707, 548, 1033, 1293, 799, 541, 1009, 1285, 883, 561, 893, 1263, 1003, 550, 774, 1234, 1075, 587, 660, 1191, 1175, 626, 590, 1164, 1267, 700, 569, 1131, 1330, 828, 610, 1091, 1357, 994, 669, 1028, 1413, 1134, 716, 959, 1412, 1264, 762, 863, 1390, 1361, 810, 787, 1342, 1443, 865, 733, 1259, 1440, 912, 701, 1186, 1415, 1035, 679, 1042, 1417, 1094, 693, 925, 1365, 1214, 704, 809, 1348, 1291, 747, 715, 1290, 1366, 811, 677, 1223, 1401, 880, 652, 1135, 1399, 974, 657, 1038, 1392, 1078, 667, 920, 1367, 1197, 686, 810, 1329, 1277, 729, 722, 1274, 1349, 788, 663, 1225, 1396, 881, 569, 1134, 1393, 957, 658, 1028, 1383, 1063, 668, 911, 1358, 1171, 680, 813, 1330, 1272, 716, 718, 1268, 1324, 768, 644, 1240, 1383, 838, 647, 1128, 1387, 925, 641, 1038, 1371, 1049, 654, 924, 1363, 1154, 677, 812, 1320, 1255, 709, 713, 1276, 1334, 742, 663, 1193, 1398, 830, 651, 1141, 1381, 898, 622, 1005, 1354, 1039, 640, 916, 1330, 1141, 672, 815, 1316, 1265, 710, 717, 1286, 1339, 769, 677, 1227, 1400, 854, 644, 1151, 1390, 937, 657, 1050, 1382, 1047, 652, 943, 1352, 1141, 662, 835, 1323, 1223, 686, 707, 1252, 1259, 734, 782, 1484, 1763, 1296, 1141, 1653, 1867, 1379, 1037, 1352, 1599, 1184, 696, 912, 1261, 990, 493, 668, 1123, 1026, 499, 542, 1092, 1115, 562, 475, 1054, 1194, 652, 468, 983, 1223, 758, 512, 917, 1229, 874, 518, 831, 1240, 1000, 545, 723, 1208, 1095, 567, 634, 1182, 1193, 625, 553, 1128, 1252, 682, 545, 1008, 1240, 763, 506, 903, 1235, 858, 510, 791, 1216, 969, 528, 702, 1199, 1087, 591, 655, 1202, 1226};

    vector<double> dirty;
    for(auto q: qq)
        dirty.push_back(q);

    vector<double> clean;
    vector<double> no_dc;

    removeDc(dirty, 250, &no_dc);

    emdFilter(no_dc,  &clean);

    //print(dirty);
    print(clean);
}
